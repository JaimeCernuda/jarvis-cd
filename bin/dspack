#!/usr/bin/env python3
#!/usr/bin/env python3

"""
dspack: a distributed wrapper for spack installations.

dspack ssh_setup
dspack spack install
dspack spack uninstall
dspack prefix [pkg-name]
dspack [spack-query]
"""

import sys,os
import argparse
import re
from jarvis_cd.bootstrap.spack_setup import SpackSetup
from jarvis_cd.bootstrap.spack_wrapper import SpackWrapper
from jarvis_cd.bootstrap.ssh_setup import SSHSetup
from jarvis_cd.bootstrap.jarvis_setup import JarvisSetup

if __name__ == '__main__':
    # Get top-level operation
    op_args = sys.argv[1:2]
    other_args = []
    if len(sys.argv) > 2:
        other_args = sys.argv[2:]
    op_parser = argparse.ArgumentParser(description='dspack script')
    op_parser.add_argument("operation", metavar='operation (setup_ssh,spack,jarvis)', type=str,
                                help="The dspack operation")
    args = op_parser.parse_args(op_args)
    op = args.operation

    # Second-level args
    parser = None
    if op == 'setup_ssh':
        parser = SSHSetup(other_args)
    elif op == 'spack':
        parser = SpackSetup(other_args)
    elif op == 'jarvis':
        parser = JarvisSetup(other_args)
    else:
        parser = SpackWrapper(other_args)
    parser.ParseArgs()
    parser.DoArgs()