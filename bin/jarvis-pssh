#!/usr/bin/env python3

import sys,os
from jarvis_cd.bootstrap.config import BootstrapConfig
from jarvis_cd.comm.ssh_node import SSHNode
from jarvis_cd.bootstrap.ssh_args import SSHArgs

class SSHCommand(SSHArgs):
    def __init__(self, conf, op):
        self.conf = conf
        self.op = str(op)
        self.ParseSSHArgs()

    def Run(self):
        print(self.hosts)
        print(self.op)
        SSHNode("Run Command", self.hosts, self.op, pkey=self.private_key, username=self.username, port=self.port, collect_output=False, do_ssh=self.do_ssh, sudo=True).Run()

if __name__ == '__main__':
    if len(sys.argv) != 2:
        print("USAGE: jarvis-pssh [command]")
        exit()
    op = sys.argv[1]
    conf = BootstrapConfig().LoadConfig().Get()
    ssh_cmd_node = SSHCommand(conf, op)
    ssh_cmd_node.Run()

